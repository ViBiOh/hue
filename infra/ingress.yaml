---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: hue-auth
  namespace: default
spec:
  encryptedData:
    users: AgAkKLPWCr7W0EZuei5Je/cRxcnDujnXpFwFjCagKGTYjNG/29+pfbElqFRN5xRh/Dt1oqJqO5/OUzcQJE3m8p72pKibgBuRBX6ySAUwR5J2rZ8D81lA9I474dcoI92zRsyIxE4VNr/c2gkFjkkPEz64c13tRPTezWhr40GP5Vb0gaAWEm2fgC0ydjP8yHaDjYV1ppgbZx1EnqTG/IAAwKsi/wMSF+FW9wIU9kmiwinNhKUjqo7C64URAxWJIK+shw/d5NYNWjHCTItBdB6/WKbEcCKdYV7/yzMsdpFSEHOKK1q3urPm7Y+IFJQoDGPfcmIVCvibXE8UcyVrdcXAgldb3ZEVr6rxkEBpFti3U868/X3xHlISnRtrboziY6ELf559/esX4RRo10BUqnOuUr4c74G8NAPZ8CcwYLhx0Fwz327Pywq9FALYbjSEhtytHAJWBJMsDbq6luvMK2502+CAOJWQR4VIT7NugveAjqLt4QyZidTfgIJEFjESyhvSmtZ0z1Hiz0cJ4fKOhnw2CxTu5AbGZS3QtHervgUFDyb7XSkAuUALE4Qr7e5VV3FZmx/Ukpmv7Q8K+NNuacgJAG/N9ngab/S6LSq2wewLJHJ5iJdO0xaMqVZtnu96Xrmfi0gis+Y6ARm/kSLfuOJUcavI+uO9hd4PZDJRAhTfNIm1Kn/XB1iVLe4EZV8PW61nyjK5L2Bbkli6bt0dL5JYQFyU8L0OfrSpCbJq2tWNCK/cqDkhckO9RFKnzJ8j4h3V2wfl42SNzzsUWr1WRGp2XcUq6VG3
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: hue-auth
  namespace: default
  labels:
    app.kubernetes.io/name: hue
    app.kubernetes.io/instance: hue
    app.kubernetes.io/managed-by: kubectl
spec:
  basicAuth:
    secret: hue-auth
    removeHeader: true
---
apiVersion: v1
kind: Service
metadata:
  name: hue
  namespace: default
spec:
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
---
apiVersion: v1
kind: Endpoints
metadata:
  name: hue
  namespace: default
subsets:
  - addresses:
      - ip: 192.168.1.120
    ports:
      - port: 80
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: hue
  namespace: default
  labels:
    app.kubernetes.io/instance: hue
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: hue
spec:
  secretName: hue-tls
  dnsNames:
    - hue.vibioh.fr
  issuerRef:
    kind: ClusterIssuer
    name: letsencrypt
    group: cert-manager.io
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  labels:
    app.kubernetes.io/instance: hue
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: hue
  name: hue-http
  namespace: default
spec:
  entryPoints:
    - web
  routes:
    - kind: Rule
      match: Host(`hue.vibioh.fr`)
      middlewares:
        - name: ratelimit@file
        - name: compress@file
        - name: redirect@file
      services:
        - name: hue
          port: 80
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  labels:
    app.kubernetes.io/instance: hue
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: hue
  name: hue-https
  namespace: default
spec:
  entryPoints:
    - websecure
  routes:
    - kind: Rule
      match: Host(`hue.vibioh.fr`)
      middlewares:
        - name: ratelimit@file
        - name: compress@file
        - name: hue-auth
          namespace: default
      services:
        - name: hue
          port: 80
  tls:
    secretName: hue-tls
